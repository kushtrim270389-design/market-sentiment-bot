<script>
(async () => {
  const root = document.getElementById('list');
  root.textContent = 'Lade Datenâ€¦';

  try {
    const res = await fetch('./signals.json?_=' + Date.now());
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();

    // data kann Objekt ODER Array sein:
    const d = Array.isArray(data) ? (data[0] || {}) : data;

    root.innerHTML = '';

    // Zeitstempel, falls vorhanden
    if (d.updated_at) {
      const ts = document.createElement('p');
      ts.innerHTML = `<small>Letztes Update: ${new Date(d.updated_at).toLocaleString()}</small>`;
      root.appendChild(ts);
    }

    const results = d.results || [];
    if (!results.length) {
      root.innerHTML += '<p><b>Keine Ergebnisse gefunden.</b></p>';
      return;
    }

    results.forEach(x => {
      const div = document.createElement('div');
      const sig = x.signal || 'NEUTRAL';
      const score = (x.news_score ?? x.final_score ?? 0);
      const used = x.articles_used ?? '-';
      div.className = 'card';
      div.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <b>${x.asset || 'Unbekannt'}</b>
          <span class="badge ${sig}">${sig}</span>
        </div>
        <div>Score: <b>${score}</b> &middot; Artikel: ${used}</div>
      `;
      root.appendChild(div);
    });
  } catch (err) {
    root.innerHTML = '<p style="color:#c62828"><b>Fehler:</b> ' + String(err) + '</p>' +
                     '<p>Teste <a href="./signals.json" target="_blank">signals.json</a> direkt.</p>';
  }
})();
</script>
